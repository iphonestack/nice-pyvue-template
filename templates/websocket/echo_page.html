<!doctype html>
<html lang="zh-Hans">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Websocket Demo</title>
    <script src="//unpkg.com/vue/dist/vue.js"></script>
    <style>
        #app {
            margin: 20px 10%;
        }

        #hello-vue {
            width: 55%;
            float: left;
        }

        #hello-socket {
            width: 45%;
            padding: 20px 0;
            float: right;
        }
    </style>
</head>
<body>
<div id="app">
    <div id="hello-vue">
        <img src="https://vuejs.org/images/logo.png" alt="Vue logo">
        <h1>[[ greeting ]]</h1>
        <ul>
            <li>
                To learn more about Vue, visit
                <a :href="docsURL" target="_blank">[[ humanizeURL(docsURL) ]]</a>
            </li>
            <li>
                For live help with simple questions, check out
                <a :href="gitterURL" target="_blank">the Gitter chat</a>
            </li>
            <li>
                For more complex questions, post to
                <a :href="forumURL" target="_blank">the forum</a>
            </li>
        </ul>
    </div>
    <div id="hello-socket">
        <label for="username">Your name:</label>
        <input id="username" type="text" v-model="username" placeholder="What's your name?"
               @keyup.enter="submitName">
        <p v-if="hasUsername">Welcome: [[ username ]]!</p>
        <div id="messages">
            <p>Messages from server:</p>
            <hr>
            <p v-for="msg in messages">[[ msg ]]</p>
        </div>
    </div>
</div>
<script>
    new Vue({
        el: '#app',
        delimiters: ['[[', ']]'],
        data: function () {
            return {
                greeting: 'Welcome to Vue.js websocket!',
                docsURL: 'http://vuejs.org/guide/',
                gitterURL: 'https://gitter.im/vuejs/vue',
                forumURL: 'http://forum.vuejs.org/',
                username: '',
                messages: [],
                ws: new WebSocket((location.protocol === 'http:' ? 'ws:' : 'wss:') +
                    '//' + location.hostname + (location.port ? ':' + location.port : '') +
                    '/tornado/socks/echo')
            }
        },
        computed: {
            hasUsername: function () {
                return this.username !== ''
            }
        },
        methods: {
            humanizeURL: function (url) {
                return url
                    .replace(/^https?:\/\//, '')
                    .replace(/\/$/, '')
            },
            submitName: function () {
                this.ws.send(this.username)
            },
            onMessage: function (event) {
                if (this.messages.length >= 12) {
                    this.messages.pop()
                }
                this.messages.unshift(event.data)
            }
        },
        mounted: function () {
            this.ws.onmessage = this.onMessage
        }
    })
</script>
</body>
</html>
